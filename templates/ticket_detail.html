<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Ticket</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body class="bg-dark text-white">
<div class="container mt-5">
    <form method="POST">
        <div class="mb-3">
            <label for="ticket_no" class="form-label">Ticket No</label>
            <input type="text" class="form-control bg-white text-dark" id="ticket_no" value="{{ ticket.ticket_no }}" readonly>
        </div>

        <div class="mb-3">
            <label for="status" class="form-label">Status</label>
            <select name="status" class="form-select">
                {% for option in ['New', 'On Hold', 'In Progress', 'Closed'] %}
                    <option value="{{ option }}" {% if ticket.status == option %}selected{% endif %}>{{ option }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Description:</label>
          <textarea name="description" class="form-control" rows="4">{{ ticket.description }}</textarea>
        </div>

        <div class="mb-3">
            <label for="assigned_to" class="form-label">Assigned To</label>
            <select name="assigned_to" class="form-select">
                <option value="">-- Select User --</option>
                {% for user in users %}
                    <option value="{{ user.id }}" {% if ticket.assigned_to == user.id %}selected{% endif %}>{{ user.username }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-success">Save</button>
            <a href="{{ url_for('list_tickets') }}" class="btn btn-secondary">Cancel</a>
            
        </form>
        <hr class="my-4">

    <h4>Comments</h4>
    {% for comment in ticket.comments %}
      <div class="bg-secondary p-3 mb-3 rounded">
        <strong>{{ comment.author }}</strong> on {{ comment.timestamp.strftime('%d-%m-%Y %H:%M:%S') }}:
        <div class="mt-2">{{ comment.content }}</div>
      </div>
    {% else %}
      <p>No comments yet.</p>
    {% endfor %}

    <form method="POST" action="{{ url_for('edit_ticket', ticket_id=ticket.id) }}">
      <div class="mb-3">
        <label class="form-label">Add Comment:</label>
        <textarea name="new_comment" class="form-control" rows="3" placeholder="Write your comment..."></textarea>
      </div>
      <button type="submit" class="btn btn-success">Submit Comment</button>
    </form>
  </div>
</body>
</html>